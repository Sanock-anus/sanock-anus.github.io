<!DOCTYPE html>
<html lang="ru">
<head>
    <meta name="yandex-verification" content="0ff9479251bdef9d" />
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ú–ê–•‚öôÔ∏è–í–ò–ö & GAME MEF</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
</head>
<body class="theme-default">

    <header>
        <nav>
            <div class="logo">
                <img src="–ú–ê–•‚öôÔ∏è–í–ò–ö.png" alt="–õ–æ–≥–æ—Ç–∏–ø –ú–ê–•‚öôÔ∏è–í–ò–ö" class="logo-img">
                <img src="–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ WhatsApp 2025-08-28 –≤ 22.16.06_5d40c46f.jpg" alt="–õ–æ–≥–æ—Ç–∏–ø Game MEF" class="logo-img">
            </div>
            <ul>
                <li><a href="#about">–û –Ω–∞—Å</a></li>
                <li><a href="#games">–ù–∞—à–∏ –∏–≥—Ä—ã</a></li>
                <li><a href="#community">–°–æ–æ–±—â–µ—Å—Ç–≤–æ</a></li>
            </ul>
        </nav>
    </header>

    <main>
        <section id="hero">
            <div class="hero-content">
                <h1>–ú–ê–•‚öôÔ∏è–í–ò–ö & GAME MEF</h1>
                <div class="dl-counter" style="margin: 15px 0; font-weight: bold; color: #e67e22;">
                    üì• –°–∫–∞—á–∏–≤–∞–Ω–∏–π: <span id="count-number">0</span>
                </div>
            </div>
        </section>

        <section id="games" class="section">
            <div class="container" style="text-align:center;">
                <h2>–ù–∞—à–∏ –∏–≥—Ä—ã</h2>
                <div class="game-card" style="background:#2c3e50; padding:20px; border-radius:15px; display:inline-block;">
                    <img src="Game.jpg" alt="5 –Ω–æ—á–µ–π –≤ —à–∞—Ä–∞–≥–µ" style="max-width: 200px; border-radius: 10px;">
                    <h3>5 –Ω–æ—á–µ–π –≤ —à–∞—Ä–∞–≥–µ</h3>
                    <a href="https://drive.google.com/file/d/1DpQU2blWeWgafjGmtvx7WU4kW8iIUcTY/view" class="cta-button" onclick="countDl()">–ü–ö</a>
                    <a href="https://drive.google.com/file/d/1a0cGmqNwIjfC5tUsAgG4hSO4xOG0aSYf/view" class="cta-button" onclick="countDl()">Android</a>
                </div>
            </div>
        </section>

        <section id="community" class="section">
            <div class="container">
                <h2>–°–æ–æ–±—â–µ—Å—Ç–≤–æ ‚ùÑÔ∏è</h2>
                
                <div id="auth-box" style="background: rgba(255,255,255,0.05); padding: 20px; border-radius: 15px; border: 1px solid #3498db; margin-bottom: 20px; text-align: left;">
                    <div id="user-info" style="display:none; margin-bottom:10px;">
                        –í—ã –≤–æ—à–ª–∏ –∫–∞–∫: <strong id="current-user-display" style="color:#3498db;"></strong> 
                        <button onclick="logout()" style="background:#e74c3c; padding:3px 10px; font-size:0.8em;">–í—ã–π—Ç–∏</button>
                    </div>
                    <div id="auth-forms">
                        <input type="text" id="c-name" placeholder="–ù–∏–∫–Ω–µ–π–º" style="width:48%; margin-bottom:10px; padding:8px; background:#333; color:#fff; border:1px solid #444;">
                        <input type="email" id="c-email" placeholder="–ü–æ—á—Ç–∞" style="width:48%; margin-bottom:10px; padding:8px; background:#333; color:#fff; border:1px solid #444;">
                        <input type="password" id="c-pass" placeholder="–ü–∞—Ä–æ–ª—å" style="width:100%; margin-bottom:10px; padding:8px; background:#333; color:#fff; border:1px solid #444;">
                        <button onclick="register()" class="cta-button" style="background:#2ecc71;">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button>
                        <button onclick="login()" class="cta-button" style="background:#3498db;">–í–æ–π—Ç–∏</button>
                    </div>
                </div>

                <div id="msg-input-area" style="display:none; background: rgba(255,255,255,0.05); padding: 20px; border-radius: 15px; border: 1px solid #e67e22; margin-bottom: 20px;">
                    <textarea id="c-msg" placeholder="–í–∞—à –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π..." style="width:100%; height:80px; margin-bottom:10px; padding:8px; border-radius:5px; background:#333; color:#fff; border:1px solid #444;"></textarea>
                    <button id="send-msg" class="cta-button">–û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å</button>
                </div>
                
                <div id="posts-wall">–ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π...</div>
            </div>
        </section>
    </main>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyBcQP8-B9zt_dKdj2Ns99H6aaqzQb8OnLc",
            authDomain: "makhovicksite.firebaseapp.com",
            projectId: "makhovicksite",
            storageBucket: "makhovicksite.firebasestorage.app",
            messagingSenderId: "245142284614",
            appId: "1:245142284614:web:fd01f94ef372ebc0ad1d47",
            databaseURL: "https://makhovicksite-default-rtdb.firebaseio.com"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        const auth = firebase.auth();

        let currentUser = null;

        // --- –õ–û–ì–ò–ö–ê –ê–ö–ö–ê–£–ù–¢–û–í ---
        function register() {
            const email = document.getElementById('c-email').value;
            const pass = document.getElementById('c-pass').value;
            const name = document.getElementById('c-name').value;
            if(!name) return alert("–í–≤–µ–¥–∏—Ç–µ –Ω–∏–∫!");
            
            auth.createUserWithEmailAndPassword(email, pass)
                .then((userCredential) => {
                    userCredential.user.updateProfile({ displayName: name });
                    alert("–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞!");
                }).catch(err => alert(err.message));
        }

        function login() {
            const email = document.getElementById('c-email').value;
            const pass = document.getElementById('c-pass').value;
            auth.signInWithEmailAndPassword(email, pass).catch(err => alert(err.message));
        }

        function logout() { auth.signOut(); }

        auth.onAuthStateChanged(user => {
            currentUser = user;
            const authForms = document.getElementById('auth-forms');
            const userInfo = document.getElementById('user-info');
            const msgInput = document.getElementById('msg-input-area');
            
            if(user) {
                authForms.style.display = 'none';
                userInfo.style.display = 'block';
                msgInput.style.display = 'block';
                document.getElementById('current-user-display').innerText = user.displayName || user.email;
            } else {
                authForms.style.display = 'block';
                userInfo.style.display = 'none';
                msgInput.style.display = 'none';
            }
        });

        // --- –õ–ê–ô–ö–ò –ò –ö–û–ú–ú–ï–ù–¢–´ ---
        function parseVideo(text) {
            const ytReg = /(?:https?:\/\/)?(?:www\.)?(?:youtube\.com\/watch\?v=|youtu\.be\/)([a-zA-Z0-9_-]{11})/;
            const match = text.match(ytReg);
            return match ? `<br><iframe width="100%" height="200" src="https://www.youtube.com/embed/${match[1]}" frameborder="0" allowfullscreen style="margin-top:10px;"></iframe>` : "";
        }

        window.toggleVote = function(id, type) {
            if(!currentUser) return alert("–í–æ–π–¥–∏—Ç–µ –≤ –∞–∫–∫–∞—É–Ω—Ç!");
            const userId = currentUser.uid;
            const voteRef = db.ref(`posts/${id}/votes/${userId}`);
            
            voteRef.once('value', snap => {
                if(snap.val() === type) {
                    voteRef.remove(); // –£–±–∏—Ä–∞–µ–º –ª–∞–π–∫, –µ—Å–ª–∏ –Ω–∞–∂–∞–ª–∏ –≤—Ç–æ—Ä–æ–π —Ä–∞–∑
                } else {
                    voteRef.set(type); // –°—Ç–∞–≤–∏–º –∏–ª–∏ –º–µ–Ω—è–µ–º –ª–∞–π–∫/–¥–∏–∑–ª–∞–π–∫
                }
            });
        };

        window.deletePost = function(id) {
            if(confirm("–£–¥–∞–ª–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ?")) db.ref(`posts/${id}`).remove();
        };

        document.getElementById('send-msg').onclick = () => {
            const t = document.getElementById('c-msg').value;
            if(t && currentUser) {
                db.ref('posts').push({
                    uid: currentUser.uid,
                    n: currentUser.displayName || "–ê–Ω–æ–Ω–∏–º",
                    t, 
                    time: new Date().toLocaleString()
                });
                document.getElementById('c-msg').value = '';
            }
        };

        db.ref('posts').on('value', snap => {
            const wall = document.getElementById('posts-wall');
            wall.innerHTML = '';
            const data = snap.val();
            for(let id in data) {
                const p = data[id];
                const votes = p.votes || {};
                const likes = Object.values(votes).filter(v => v === 'up').length;
                const dislikes = Object.values(votes).filter(v => v === 'down').length;
                const myVote = currentUser ? votes[currentUser.uid] : null;
                
                const isOwner = currentUser && (currentUser.uid === p.uid || currentUser.email === 'sanokgameplay@gmail.com');

                let html = `
                    <div style="background:#2c3e50; padding:15px; border-radius:10px; margin-bottom:15px; border-left:4px solid #e67e22; color:white;">
                        <div style="display:flex; justify-content:space-between;">
                            <strong style="color:#e67e22;">${p.n}</strong>
                            <div>
                                ${isOwner ? `<button onclick="deletePost('${id}')" style="background:none; border:none; color:#e74c3c; cursor:pointer; margin-right:10px;">üóë</button>` : ''}
                                <small style="opacity:0.5;">${p.time}</small>
                            </div>
                        </div>
                        <p>${p.t}${parseVideo(p.t)}</p>
                        <div style="display:flex; gap:10px;">
                            <button onclick="toggleVote('${id}', 'up')" style="background:none; border:none; color:${myVote==='up'?'#2ecc71':'#888'}; cursor:pointer;">üëç ${likes}</button>
                            <button onclick="toggleVote('${id}', 'down')" style="background:none; border:none; color:${myVote==='down'?'#e74c3c':'#888'}; cursor:pointer;">üëé ${dislikes}</button>
                        </div>
                    </div>
                `;
                wall.insertAdjacentHTML('afterbegin', html);
            }
        });

        // –°—á—ë—Ç—á–∏–∫ —Å–∫–∞—á–∏–≤–∞–Ω–∏–π
        const countRef = db.ref('downloads/total');
        countRef.on('value', (s) => document.getElementById('count-number').innerText = s.val() || 0);
        function countDl() { countRef.transaction(c => (c || 0) + 1); }

        // –°–Ω–µ–≥
        setInterval(() => {
            const s = document.createElement('div');
            s.innerHTML = '‚ùÑ';
            s.style.cssText = `position:fixed; top:-20px; color:white; pointer-events:none; left:${Math.random()*100}vw; animation: fall ${Math.random()*3+2}s linear forwards; z-index:9999;`;
            document.body.appendChild(s);
            setTimeout(() => s.remove(), 5000);
        }, 300);
    </script>
    <style> @keyframes fall { to { transform: translateY(105vh); } } </style>
</body>
</html>
